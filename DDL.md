# SEQUENCES

Gonna need to generate values in a sequentially? Went to the right place, pal!

## Creating sequences

Create a simple sequence

```sql
CREATE SEQUENCE sequence_name
  START WITH 1
  INCREMENT BY 1
```

Create a sequence with boundaries

```sql
CREATE SEQUENCE sequence_name
  START WITH 10
  INCREMENT BY 1
  MINVALUE 10 MAXVALUE 1000
```

> **Note:** Of course You gotta take care to not start before the min value and not to limit to something smaller than the initial one

**Some other possible definitions:**

| Definition | Description                                                                         |
| ---------- | ----------------------------------------------------------------------------------- |
| CYCLE      | Makes the sequence start again from the initial value when the max value is reached |
| CACHE      | Allocated the next N values in memory to optimize performance, allow gaps           |
| ORDER      | Ensures the values are generated in order                                           |

```sql
CREATE SEQUENCE sequence_name
  START WITH 1
  INCREMENT BY 1
  MINVALUE 1 MAXVALUE 5
  CYCLE
  CACHE 2
  ORDER
```

## CURRVAL and NEXTVAL: Accessing current and next value

We can get the next value of a sequence or check the current one by running a query like this:

```sql
-- Gets the current value. Don't forget to initialize the sequence first
SELECT sequence_name.CURRVAL FROM DUAL

-- Get the next value. Also initializes a sequence :)
SELECT sequence_name.NEXTVAL FROM DUAL
```

> **Note:** This DUAL table is a special one that You can use to query things that are not actual table. Try to make a SELECT on it directly

## Can I alter my sequence once created?

Sure You can, but there are some limitations:

- You cannot change the initial value of a sequence;
- The minimum value cannot be bigger than the current one;
- The maximum value cannot be smaller than the current one;
- You cannot restart a sequence;

The syntax:

```sql
ALTER SEQUENCE sequence_name
  INCREMENT BY 5
  MAXVALUE 100
```

## Tired of playing along?

Drop Your sequence with that:

```sql
DROP SEQUENCE sequence_name
```

# IDENTITIES

Since version 12c of Oracle we can just create identities to handle primary keys. Lets take a look!

You can use two strategies to generate the identity on a table: ALWAYS and BY DEFAULT.

## ALWAYS

```sql
CREATE TABLE table_name (
  id INTEGER GENERATED ALWAYS AS IDENTITY (
    START WITH 2 INCREMENT BY 2 MAXVALUE 1000
  ),
  name VARCHAR(255)
)
```

This way You can't specify the ID value during the INSERT of a new line. If You need to, follow for the BY DEFAULT.

## BY DEFAULT

```sql
CREATE TABLE table_name (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY (
    START WITH 2 INCREMENT BY 2 MAXVALUE 1000
  ),
  name VARCHAR(255)
)â—Š
```

This way You are free to omit the id, using the identity as default, or specify a value for the id column during an INSERT statement.

# Interesting constraints

| Constraint  | Description                                                                                                |
| ----------- | ---------------------------------------------------------------------------------------------------------- |
| PRIMARY KEY | Makes the column the identifier for that column, automatically NOT NULL and UNIQUE                         |
| UNIQUE      | Makes the column UNIQUE, the lines cannot repeat this value                                                |
| FOREIGN KEY | Makes the column a kind of pointer to another table, it helps You to reference relationship between tables |
| CHECK       | Allows You to create a validation to run at the moment of insert                                           |

# Exercise it!

Create a table. Set its id to always generated with an identity.

### TASKS

| Column     | Type    |
| ---------- | ------- |
| id         | integer |
| title      | text    |
| completed  | boolean |
| created_at | date    |
