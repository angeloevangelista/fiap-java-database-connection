DROP TABLE users CASCADE CONSTRAINTS;
DROP TABLE tasks CASCADE CONSTRAINTS;

CREATE TABLE users (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY (
    START WITH 1 INCREMENT BY 1 MAXVALUE 10000
  ),
  name VARCHAR(255),
  
  PRIMARY KEY (id)
);

CREATE TABLE tasks (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY (
    START WITH 1 INCREMENT BY 1 MAXVALUE 10000
  ),
  user_id INTEGER,
  title VARCHAR(255),
  completed CHAR(1),
  created_at DATE,
  dead_line DATE,
  
	PRIMARY KEY (id)
);

ALTER TABLE tasks
ADD CONSTRAINT fk_users
FOREIGN KEY (user_id)
REFERENCES users(id);

ALTER TABLE tasks
ADD CONSTRAINT chk_dead_line_is_valid
CHECK (dead_line > created_at);

ALTER TABLE tasks
ADD CONSTRAINT chk_completed_flag
CHECK (completed IN ('Y', 'N'));

-- DQL
ALTER TABLE tasks
ADD priority VARCHAR(50) DEFAULT 'NORMAL';

ALTER TABLE tasks
ADD completion DECIMAL(3, 2) DEFAULT 0;
